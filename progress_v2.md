# PRD v2.0 对应进度清单

基准文档：
- `docs/PRD_企业级私教工作室管理系统_发布版_v2.0.md`

更新时间：2026-02-22

## v2.0 总目标
- [ ] 多门店总部治理能力上线
- [ ] 数据权限模型上线（`TENANT_ALL` / `STORE_ASSIGNED` / `SELF_ONLY`）
- [ ] 按钮级权限配置页面上线
- [ ] 财务一致性稽核中心上线
- [ ] outbox 事件重试与补偿能力完善
- [ ] 总部经营 BI 看板上线

## 基础环境
- [x] 中间件基础环境（MySQL/Redis/RocketMQ）本地 compose 编排
- [x] 中间件连通性冒烟脚本（`scripts/middleware_smoke.sh`）
- [x] profile 配置文件（`application-mysql.yml` / `application-redis.yml` / `application-mq.yml`）

## User Stories 映射

### US-001 多门店组织管理
- [x] 门店新增/编辑/停用接口（已支持新增、停用/启用）
- [x] 门店列表与状态查询
- [x] 停用门店写操作拦截
- [x] 门店组织变更审计

### US-002 总部-门店数据权限模型
- [x] 角色数据范围模型定义（`TENANT_ALL`/`STORE_ASSIGNED`/`SELF_ONLY`）
- [x] 查询接口数据范围过滤（已接入 `/api/admin/stores`）
- [x] 越权访问标准错误 + 安全审计
- [x] 跨租户/跨门店/跨角色回归测试（专项用例已补）

### US-003 角色与按钮级权限配置页面
- [~] 角色管理页（角色、菜单、按钮）（后端权限配置接口已完成，页面待实现）
- [x] 用户授权页（用户-角色绑定）（后端接口已具备）
- [x] 权限变更生效机制（缓存刷新）（已提供权限版本号）
- [x] 前后端权限一致性验证（已提供用户有效权限快照接口）

### US-004 财务一致性稽核中心
- [x] 日结稽核总览（订单/支付/退款/课消/提成）
- [x] 异常明细清单
- [x] 异常处理（重试/人工关闭）
- [x] 门店维度导出（CSV）

### US-005 预约/课消事件驱动补偿
- [x] 预约事件 outbox 入库（`mq+mysql` 已完成）
- [x] 课消事件 outbox 入库
- [x] outbox 重试任务与死信策略
- [x] 事件补偿演练脚本

### US-006 总部经营 BI 看板
- [x] 总部总览指标
- [x] 门店排行与趋势对比
- [x] 指标口径配置
- [x] 门店钻取明细

## Functional Requirements 映射
- [x] FR-1 多门店组织管理
- [ ] FR-2 总部/门店两级角色体系
- [x] FR-3 数据范围自动生效
- [~] FR-4 权限可视化配置（后端已完成，前端待实现）
- [~] FR-5 关键写操作事务一致性（v1 已落地主链路，v2 持续回归）
- [x] FR-6 财务稽核与异常清单
- [x] FR-7 outbox 事件补偿
- [x] FR-8 总部 BI 与钻取分析
- [x] FR-9 安全审计能力（已扩展数据范围拒绝审计日志）
- [ ] FR-10 安全回归测试入 CI 分层

## 验收里程碑
- [ ] M2-1：多门店与数据权限模型
- [ ] M2-2：权限配置页面 + 权限回归
- [ ] M2-3：稽核中心 + outbox补偿
- [ ] M2-4：总部BI + v2.0 验收
