# PRD v2.0 对应进度清单

基准文档：
- `docs/PRD_企业级私教工作室管理系统_发布版_v2.0.md`

更新时间：2026-02-22

## v2.0 总目标
- [ ] 多门店总部治理能力上线
- [ ] 数据权限模型上线（`TENANT_ALL` / `STORE_ASSIGNED` / `SELF_ONLY`）
- [ ] 按钮级权限配置页面上线
- [ ] 财务一致性稽核中心上线
- [ ] outbox 事件重试与补偿能力完善
- [ ] 总部经营 BI 看板上线

## 基础环境
- [x] 中间件基础环境（MySQL/Redis/RocketMQ）本地 compose 编排
- [x] 中间件连通性冒烟脚本（`scripts/middleware_smoke.sh`）
- [x] profile 配置文件（`application-mysql.yml` / `application-redis.yml` / `application-mq.yml`）

## User Stories 映射

### US-001 多门店组织管理
- [ ] 门店新增/编辑/停用接口
- [ ] 门店列表与状态查询
- [ ] 停用门店写操作拦截
- [ ] 门店组织变更审计

### US-002 总部-门店数据权限模型
- [ ] 角色数据范围模型定义
- [ ] 查询接口数据范围过滤
- [ ] 越权访问标准错误 + 安全审计
- [ ] 跨租户/跨门店/跨角色回归测试

### US-003 角色与按钮级权限配置页面
- [ ] 角色管理页（角色、菜单、按钮）
- [ ] 用户授权页（用户-角色绑定）
- [ ] 权限变更生效机制（缓存刷新）
- [ ] 前后端权限一致性验证

### US-004 财务一致性稽核中心
- [ ] 日结稽核总览（订单/支付/退款/课消/提成）
- [ ] 异常明细清单
- [ ] 异常处理（重试/人工关闭）
- [ ] 门店维度导出

### US-005 预约/课消事件驱动补偿
- [~] 预约事件 outbox 入库（`mq+mysql` 已完成）
- [ ] 课消事件 outbox 入库
- [ ] outbox 重试任务与死信策略
- [ ] 事件补偿演练脚本

### US-006 总部经营 BI 看板
- [ ] 总部总览指标
- [ ] 门店排行与趋势对比
- [ ] 指标口径配置
- [ ] 门店钻取明细

## Functional Requirements 映射
- [ ] FR-1 多门店组织管理
- [ ] FR-2 总部/门店两级角色体系
- [ ] FR-3 数据范围自动生效
- [ ] FR-4 权限可视化配置
- [~] FR-5 关键写操作事务一致性（v1 已落地主链路，v2 持续回归）
- [ ] FR-6 财务稽核与异常清单
- [~] FR-7 outbox 事件补偿（预约已完成，课消及任务待完成）
- [ ] FR-8 总部 BI 与钻取分析
- [~] FR-9 安全审计能力（越权专项已建立，需扩展至v2新接口）
- [ ] FR-10 安全回归测试入 CI 分层

## 验收里程碑
- [ ] M2-1：多门店与数据权限模型
- [ ] M2-2：权限配置页面 + 权限回归
- [ ] M2-3：稽核中心 + outbox补偿
- [ ] M2-4：总部BI + v2.0 验收
