# 高并发压测治理手册 v1

版本：v1  
日期：2026-02-23

## 1. 目标

建立统一的高并发压测治理流程，覆盖常规压测、故障注入压测、长稳压测与复盘输出。

## 2. 常规压测（baseline vs limited）

执行：

```bash
./scripts/perf_gateway_baseline_and_limited.sh
```

产物：
- baseline 结果：`/tmp/ptstudio-perf/gateway_baseline.json`
- limited 结果：`/tmp/ptstudio-perf/gateway_limited.json`
- 对比报告：`/tmp/ptstudio-perf/gateway_compare_report.md`

## 3. 故障注入压测

执行示例（以 Nacos 单节点故障为例）：

```bash
FAULT_NAME=nacos-node-down \
INJECT_CMD="docker stop ptstudio-nacos-2" \
RECOVER_CMD="docker start ptstudio-nacos-2" \
./scripts/perf_fault_injection_drill.sh
```

产物：
- fault 场景结果：`/tmp/ptstudio-perf-fault/gateway_fault.json`
- 故障注入报告：`docs/故障注入压测报告_v1.md`

## 4. 长稳压测（30min+）

执行示例：

```bash
python3 scripts/perf_gateway_soak_test.py \
  --duration-min 30 \
  --total 1200 \
  --concurrency 80 \
  --summary docs/长稳压测报告_v1.md \
  --env pre-prod \
  --operator your-name
```

产物：
- 每轮原始结果：`/tmp/ptstudio-soak/soak_round_*.json`
- 长稳报告：`docs/长稳压测报告_v1.md`

## 5. 瓶颈分析模板

复盘时至少覆盖：
- 应用层：线程池、连接池、GC、慢接口
- 网关层：限流命中率、429 比例、路由延迟
- 中间件层：MQ 堆积、Redis 命中率、ES 查询延迟
- 业务层：死信增长、补偿重试次数、热点租户/门店分布

建议将以下文档纳入每次版本归档：
- `docs/链路高并发压测报告_v1.md`
- `docs/故障注入压测报告_v1.md`
- `docs/长稳压测报告_v1.md`

## 6. 发布门禁建议

- 必须通过：`release_precheck` + `enterprise_readiness_check`
- 必须提供：常规压测 + 故障注入压测 + 长稳压测报告
- 若失败率或 P95 超过阈值：禁止全量发布，仅允许灰度
