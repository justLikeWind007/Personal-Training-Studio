# PRD：企业级私教工作室管理系统（v3.0）

版本：v3.0  
日期：2026-02-23  
范围：在 v2.0 基础上补齐“精细化运营 + 自动化执行 + 总部治理闭环”

## 1. 背景与目标

v2.0 已完成多门店治理、权限模型、稽核中心、outbox 补偿与总部 BI。  
v3.0 聚焦“会用数据做动作”：不仅看报表，还要把运营动作标准化、自动化、可追踪。

## 2. v3.0 核心目标

- 建立会员精细化分群与触达清单能力（可筛选、可导出、可复用）
- 建立门店运营日报自动生成与总部可见机制
- 建立门店目标（营收/消课/新增）与达成监控机制
- 建立高风险预警（退款异常、课消异常、缺勤异常）与处置闭环
- 建立版本化“运营策略配置”（阈值、规则、口径）并支持审计

## 3. User Stories

### US-101 会员分群筛选与导出
**Description:** 作为门店运营，我希望按状态、等级、关键词筛选会员，并导出名单，用于活动触达。  

**Acceptance Criteria:**
- [ ] `GET /api/members` 支持 `status`、`levelTag`、`keyword` 组合筛选
- [ ] 筛选结果保持租户门店隔离，不得跨门店返回
- [ ] `GET /api/members/export` 支持同条件导出 CSV
- [ ] 导出包含 `memberNo/name/mobile/levelTag/status/joinDate`

### US-102 门店运营日报
**Description:** 作为店长，我希望每天自动生成运营日报，快速查看昨天经营表现。  

**Acceptance Criteria:**
- [ ] 提供 `GET /api/ops/daily-summary`，默认查询昨日
- [ ] 输出新增会员、订单数、实收、退款、课消、预约到店率
- [ ] 支持门店维度查看，保持租户门店隔离
- [ ] 可导出文本摘要用于群内播报

### US-103 门店目标管理与达成率
**Description:** 作为总部运营，我希望为门店设置月目标并跟踪达成率。  

**Acceptance Criteria:**
- [ ] 提供目标设置接口（按月、按门店、按指标）
- [ ] 提供目标达成查询接口（达成率、差额、趋势）
- [ ] 目标变更进入审计日志
- [ ] 支持总部维度门店横向对比

### US-104 风险预警中心
**Description:** 作为总部风控，我希望系统自动识别高风险信号并形成待处理列表。  

**Acceptance Criteria:**
- [ ] 输出退款异常、课消逆操作异常、缺勤异常的预警清单
- [ ] 支持预警状态流转（NEW/ACK/CLOSED）
- [ ] 记录处理人和处理时间
- [ ] 支持导出与审计追溯

### US-105 运营策略版本化配置
**Description:** 作为平台管理员，我希望对阈值和规则配置进行版本管理并可回滚。  

**Acceptance Criteria:**
- [ ] 支持策略新增、发布、回滚
- [ ] 每次发布生成版本号，读取接口返回当前版本
- [ ] 关键操作写入审计日志
- [ ] 提供策略变更历史查询

## 4. Functional Requirements

- FR-1：系统必须支持会员分群筛选（状态、等级、关键词）
- FR-2：系统必须支持会员分群导出为 CSV
- FR-3：系统必须支持门店运营日报生成与查询
- FR-4：系统必须支持门店目标配置与达成计算
- FR-5：系统必须支持高风险预警识别与状态流转
- FR-6：系统必须支持运营策略版本化发布与回滚
- FR-7：所有新增能力必须遵循租户门店隔离与权限校验
- FR-8：所有关键操作必须具备审计日志

## 5. 非目标（Out of Scope）

- 不在 v3.0 内实现第三方短信/外呼平台直连
- 不在 v3.0 内实现复杂机器学习预测模型
- 不在 v3.0 内实现跨租户集中数据湖

## 6. 技术约束与考虑

- 延续现有 DDD4J 分层与 profile 双实现（`!mysql`/`mysql`）
- 新增规则配置优先采用“配置表 + 版本号”模式
- 可导出能力优先使用 CSV，避免引入重型报表依赖
- 回归测试继续纳入 `smoke/security/regression` 分层

## 7. 成功指标

- 门店活动名单准备耗时下降 50%
- 总部周例会前数据准备时间下降 40%
- 风险问题从发现到处理的平均时长下降 30%
- 关键策略变更可追溯率达到 100%

## 8. 里程碑建议

- M3-1：会员分群 + 日报能力上线
- M3-2：目标管理 + 达成看板上线
- M3-3：风险预警 + 策略版本化上线
- M3-4：v3.0 验收与回归闭环
