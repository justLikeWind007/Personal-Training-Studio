# 故障演练手册 v1

## 1. 目标

建立最小故障演练流程，验证关键中间件在异常场景下的恢复能力。

## 2. Redis Sentinel 主从切换演练

前置条件：
- 已启动 `docker-compose.cluster.yml` 中的 redis/sentinel 相关容器
- `redis-cli` 可用

执行：

```bash
./scripts/failover_drill_redis_sentinel.sh
```

检查点：
- 演练前可查询到当前 master
- 停止 master 后，Sentinel 能自动选主
- 原 master 恢复后，Sentinel 查询正常

## 3. 演练记录模板

- 演练日期：
- 演练人：
- 演练环境：
- 演练结果：通过/失败
- 失败原因：
- 改进项：

## 4. Elasticsearch 单节点故障演练

前置条件：
- 已启动 `docker-compose.cluster.yml` 中的 ES 三节点
- `docker` 与 `curl` 可用

执行：

```bash
./scripts/failover_drill_es_cluster.sh
```

检查点：
- 停止单节点后，集群节点数从 3 变为 2，且状态不为 `red`
- 演练期间索引读写请求可正常完成
- 恢复节点后，集群节点数回到 3

## 5. 后续建议

- 增加 RocketMQ NameServer/Broker 切换演练

## 6. Nacos 节点故障演练

前置条件：
- 已启动 `docker-compose.cluster.yml` 中的 Nacos 三节点
- `docker` 与 `curl` 可用

执行：

```bash
./scripts/failover_drill_nacos_cluster.sh
```

检查点：
- 停止单节点后，集群入口仍可查询服务节点信息
- 其余节点健康检查持续通过
- 恢复节点后，节点健康检查恢复

## 7. 后续建议

- 增加 RocketMQ NameServer/Broker 切换演练
